Starting Container
npm warn config production Use `--omit=dev` instead.

> storybook-worker@1.0.0 build
> tsc

npm warn config production Use `--omit=dev` instead.
üìù Registered service: IDatabaseService (singleton: true, lazy: false)

> storybook-worker@1.0.0 start
üìù Registered service: IAIService (singleton: true, lazy: true)
> node dist/index.js

‚úÖ Supabase: Environment variables configured

üöÄ StoryCanvas Job Worker Starting with Consolidated Architecture...
üîß Environment Configuration Status:
üìä Environment: production
üìä Mode: Production
‚öôÔ∏è Config: {
‚úÖ OpenAI: Environment variables configured
}
  port: 3000,
üîß Initializing job worker with resilient initialization...
  environment: 'production',
üìù Registering services...
  jobScanInterval: '*/30 * * * * *',
üìã Registering services with container...
üìù Registered service: IConfigService (singleton: true, lazy: false)
  maxConcurrentJobs: 5,
üìù Registered service: ISubscriptionConfigService (singleton: true, lazy: false)
  initialScanDelay: 10000
[SubscriptionConfigService] Using default values for: premium (SUBSCRIPTION_LIMIT_PREMIUM) 
[SubscriptionConfigService] Subscription configuration service initialized successfully 
[SubscriptionConfigService] Service initialized successfully 
üîß Initialized service: ISubscriptionConfigService
‚úÖ Resolved service: ISubscriptionConfigService
üóÑÔ∏è Initializing database service...
üîó Resolving dependencies: IConfigService
üèóÔ∏è Creating service instance: IDatabaseService
[DatabaseService] Initializing Supabase client for worker environment... 
[DatabaseService] Supabase URL: https://nzkwrrinpweiqcnzeric.s... 
[DatabaseService] Service Key: eyJhbGciOi... 
[DatabaseService] Testing Supabase connection... 
[DatabaseService] Testing database connection with storybook_entries table... 
üè• Worker health server running on port 3000
üìä Health endpoint: http://localhost:3000/health
üìà Metrics endpoint: http://localhost:3000/metrics
üîç Validation endpoint: http://localhost:3000/validate
üìù Registered service: IStorageService (singleton: true, lazy: true)
üìù Registered service: IAuthService (singleton: true, lazy: true)
üìù Registered service: ISubscriptionService (singleton: true, lazy: true)
üìù Registered service: IJobService (singleton: true, lazy: true)
üìù Registered service: IVisualConsistencyValidator (singleton: true, lazy: true)
üìù Registered service: IEnvironmentalConsistencyValidator (singleton: true, lazy: true)
üìù Registered service: ICartoonizationQualityValidator (singleton: true, lazy: true)
‚úÖ All services registered successfully (including validation services)
‚úÖ Services registered successfully
üîß Initializing core services...
üöÄ Initializing core services for job processing...
üèóÔ∏è Creating service instance: IConfigService
‚úÖ Resolved service: IConfigService
üèóÔ∏è Creating service instance: ISubscriptionConfigService
[SubscriptionConfigService] Configuration hot-reload enabled (interval: 30000ms) 
[SubscriptionConfigService] Current subscription configuration: {
  limits: { free: 1, basic: 3, premium: 10, admin: -1 },
  source: 'environment_variables',
  hotReload: true,
  validation: 'lenient'
}
[DatabaseService] Database connection test successful 
[DatabaseService] Database service initialized with verified Supabase connectivity 
[DatabaseService] Service initialized successfully 
üîß Initialized service: IDatabaseService
‚úÖ Resolved service: IDatabaseService
üìã Initializing job service...
üîó Resolving dependencies: IConfigService, IDatabaseService
üèóÔ∏è Creating service instance: IJobService
[JobService] Initialized metrics for 5 job types 
[JobService] Job service initialized successfully 
[JobService] Service initialized successfully 
üîß Initialized service: IJobService
‚úÖ Resolved service: IJobService
‚úÖ Core services initialized successfully
‚úÖ Core services initialized successfully
üîç Validating job processing system...
üèóÔ∏è Enhanced production job processor initialized with professional comic generation capabilities
‚úÖ Production job processing system loaded with Consolidated Service Architecture
‚úÖ Job system validated
‚è∞ Setting up job processing schedule...
üìÖ Scan interval: */30 * * * * *
‚úÖ StoryCanvas Job Worker initialized successfully in production mode
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üé¨ Running initial job scan...
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
üì≠ Worker: No pending jobs found or concurrency limit reached
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
üì≠ Worker: No pending jobs found or concurrency limit reached
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
üì≠ Worker: No pending jobs found or concurrency limit reached
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
[JobService] Recorded metric: progressUpdate 
[JobService] Successfully updated job progress: 36522e56-cccb-4eed-84a6-ce4a1d927b55 
üé® Starting ENHANCED storybook generation with environmental consistency and professional comic standards...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 1 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 1 jobs 
üìà Added enhanced job 36522e56-cccb-4eed-84a6-ce4a1d927b55 to processing queue (1/5)
üîÑ Processing enhanced job: 36522e56-cccb-4eed-84a6-ce4a1d927b55 (storybook) with professional comic generation capabilities
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Updating job progress: 36522e56-cccb-4eed-84a6-ce4a1d927b55 -> 1% (Starting enhanced job processing with professional comic generation) 
üìä Worker: Batch processing complete
üìà Total stats: 0 successful, 0 failed
üìä Configuration: comic-book style, children audience, reused: true
üîó Resolving dependencies: IConfigService
üèóÔ∏è Creating service instance: IAIService
[ModularEnterpriseAIService] üöÄ Initializing Revolutionary Modular AI Service... 
[ModularEnterpriseAIService] üìä Version: 2.0.0 (Modular Enterprise Comic AI) 
[ModularEnterpriseAIService] üéØ Features: 16 advanced capabilities 
[ModularEnterpriseAIService] üîß Starting modular service initialization... 
[ModularEnterpriseAIService] üèóÔ∏è Initializing modular systems... 
üè¢ Initializing Enterprise Monitoring System...
üìä Initializing metrics collection...
‚úÖ Metrics collection initialized with enterprise capabilities
üèõÔ∏è Initializing service registry...
‚úÖ Service registered: ModularEnterpriseAIService
üéØ Capabilities: 12 advanced features
üè• Initializing health monitoring...
‚úÖ Health monitoring initialized with 5-minute intervals
‚úÖ Enterprise Monitoring System initialized with comprehensive tracking
[ModularEnterpriseAIService] ‚úÖ Enterprise Monitoring System initialized 
[Gemini] ‚úÖ Gemini Integration initialized successfully
[ModularEnterpriseAIService] ‚úÖ Gemini Integration initialized (95% character consistency mode) 
Initializing Enhanced Visual DNA System...
Visual DNA System initialized with MAXIMUM consistency protocols
[ModularEnterpriseAIService] ‚úÖ Visual DNA System initialized with Gemini image-based generation 
[ModularEnterpriseAIService] ‚úÖ Narrative Intelligence Engine initialized 
üìä Initializing Quality Metrics Engine...
‚úÖ Quality baselines initialized with professional standards
[ModularEnterpriseAIService] ‚úÖ Quality Metrics Engine initialized 
üìö Pattern Learning Engine initialized
[ModularEnterpriseAIService] ‚úÖ Pattern Learning Engine initialized 
[ModularEnterpriseAIService] ‚úÖ Comic Generation Engine initialized with Gemini image-based panels 
[ModularEnterpriseAIService] üéØ All modular systems initialized successfully 
[ModularEnterpriseAIService] üîç Validating system readiness... 
üîç Performing enterprise readiness validation...
‚úÖ Service readiness validation passed
[ModularEnterpriseAIService] ‚úÖ All systems passed readiness validation 
[ModularEnterpriseAIService] üìä Starting enterprise monitoring... 
üîÑ Service registration updated: ai-service-1764834661022
[ModularEnterpriseAIService] ‚úÖ Enterprise monitoring started 
[ModularEnterpriseAIService] ‚úÖ Revolutionary Modular AI Service fully initialized and operational 
[ModularEnterpriseAIService] Service initialized successfully 
üîß Initialized service: IAIService
‚úÖ Resolved service: IAIService
[JobService] Updating job progress: 36522e56-cccb-4eed-84a6-ce4a1d927b55 -> 5% (Analyzing your story structure and creating narrative blueprint...) 
[JobService] Recorded metric: progressUpdate 
[JobService] Successfully updated job progress: 36522e56-cccb-4eed-84a6-ce4a1d927b55 
üìñ PHASE 1: Story Structure Analysis (Story-First Approach)...
[ModularEnterpriseAIService] üìñ Creating CINEMATIC story beats for world-class comic... 
[Gemini] üìù Generating text completion...
[Gemini] üîÑ Calling Gemini API... { operation: 'generateTextCompletion', timeout: '30s', type: 'text' }
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üîÑ Worker: Scanning for pending jobs using consolidated service container...
  errorType: 'AITimeoutError',
[JobService] Getting pending jobs with filter: {}, limit: 10 
    at async file:///app/dist/services/ai/ai-service-core.js:939:30
  isRetryable: true
    at async AIService.executeWithErrorHandling (file:///app/dist/services/base/error-aware-base-service.js:177:28)
}
[Gemini-ERROR] ‚ùå Text completion failed: AITimeoutError: Gemini API request timed out
üì≠ Worker: No pending jobs found or concurrency limit reached
    at GeminiIntegration.executeGeminiCall (file:///app/dist/services/ai/modular/gemini-integration.js:721:23)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
[Gemini-ERROR] ‚ùå Gemini API call timed out after 30s
    at async GeminiIntegration.generateWithRetry (file:///app/dist/services/ai/modular/gemini-integration.js:633:32)
[Gemini-ERROR] ‚ùå Attempt 1/1 failed: {
    at async GeminiIntegration.generateTextCompletion (file:///app/dist/services/ai/modular/gemini-integration.js:171:30)
  error: 'Gemini API request timed out',
}
[JobService] Job scheduled for retry: 36522e56-cccb-4eed-84a6-ce4a1d927b55 - Failed to analyze story structure: Gemini API request timed out 
  affectedServices: [ 'enhanced-job-processor' ],
  errorChain: [ 'SYSTEM_ERROR' ],
  errorCount: 1,
  rootCause: 'SYSTEM_ERROR'
  type: 'AI_TIMEOUT_ERROR',
[JobService] Recorded metric: failure 
    at async ErrorCorrelationManager.withContextResult (file:///app/dist/services/errors/error-correlation.js:47:28)
[JobService] Successfully marked job failed: 36522e56-cccb-4eed-84a6-ce4a1d927b55 
  category: 'timeout',
üìâ Removed enhanced job 36522e56-cccb-4eed-84a6-ce4a1d927b55 from processing queue (duration: 30699ms, services: job, ai, remaining: 0)
  severity: 'medium',
  retryable: true
}
    at async AIService.analyzeStoryStructure (file:///app/dist/services/ai/ai-service-core.js:882:24)
‚ùå Enhanced job 36522e56-cccb-4eed-84a6-ce4a1d927b55 failed in processEnhancedstorybookJob (UNKNOWN_ERROR): Failed to analyze story structure: Gemini API request timed out
    at async ProductionJobProcessor.processStorybookJobWithServices (file:///app/dist/lib/background-jobs/job-processor.js:464:33)
üîó Error Correlation: {
    at async ProductionJobProcessor.processJobWithServices (file:///app/dist/lib/background-jobs/job-processor.js:413:36) {
  correlationId: 'corr_1764834660773_6vcs83adr',
  timestamp: '2025-12-04T07:51:31.233Z',
  correlationId: 'err_1764834691233_zbrnddr5h',
  severity: 'high',
  service: 'GeminiIntegration',
  operation: 'generateTextCompletion',
  details: {
    timeout: 30000,
    timeoutSeconds: 30,
    operationType: 'text_generation'
  },
  type: 'AI_TIMEOUT_ERROR',
  category: 'timeout',
  severity: 'medium',
  retryable: true
}
üîó Error Correlation: {
  correlationId: 'corr_1764834661230_oye38dgug',
  severity: 'medium',
  errorCount: 1,
  affectedServices: [ 'GeminiIntegration' ]
}
‚ö†Ô∏è MEDIUM SEVERITY ERROR: {
  type: 'AI_TIMEOUT_ERROR',
  category: 'timeout',
  severity: 'medium',
  message: 'Gemini API request timed out',
  correlationId: 'err_1764834691233_zbrnddr5h',
  service: 'ModularEnterpriseAIService',
  operation: 'analyzeStoryStructure',
  timestamp: '2025-12-04T07:51:31.233Z'
}
üîó Error Correlation: {
  correlationId: 'corr_1764834661230_oye38dgug',
  severity: 'medium',
  errorCount: 2,
  affectedServices: [ 'GeminiIntegration' ]
}
‚ùå Story analysis failed: AITimeoutError: Gemini API request timed out
    at GeminiIntegration.executeGeminiCall (file:///app/dist/services/ai/modular/gemini-integration.js:721:23)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async GeminiIntegration.generateWithRetry (file:///app/dist/services/ai/modular/gemini-integration.js:633:32)
    at async GeminiIntegration.generateTextCompletion (file:///app/dist/services/ai/modular/gemini-integration.js:171:30)
    at async file:///app/dist/services/ai/ai-service-core.js:939:30
    at async AIService.executeWithErrorHandling (file:///app/dist/services/base/error-aware-base-service.js:177:28)
    at async ErrorCorrelationManager.withContextResult (file:///app/dist/services/errors/error-correlation.js:47:28)
    at async AIService.analyzeStoryStructure (file:///app/dist/services/ai/ai-service-core.js:882:24)
    at async ProductionJobProcessor.processStorybookJobWithServices (file:///app/dist/lib/background-jobs/job-processor.js:464:33)
    at async ProductionJobProcessor.processJobWithServices (file:///app/dist/lib/background-jobs/job-processor.js:413:36) {
  timestamp: '2025-12-04T07:51:31.233Z',
  correlationId: 'err_1764834691233_zbrnddr5h',
  service: 'GeminiIntegration',
  operation: 'generateTextCompletion',
  details: {
    timeout: 30000,
    timeoutSeconds: 30,
    operationType: 'text_generation'
  },
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 1 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 1 jobs 
üìà Added enhanced job 36522e56-cccb-4eed-84a6-ce4a1d927b55 to processing queue (1/5)
üîÑ Processing enhanced job: 36522e56-cccb-4eed-84a6-ce4a1d927b55 (storybook) with professional comic generation capabilities
[JobService] Updating job progress: 36522e56-cccb-4eed-84a6-ce4a1d927b55 -> 1% (Starting enhanced job processing with professional comic generation) 
üìä Worker: Batch processing complete
üìà Total stats: 0 successful, 1 failed
[JobService] Recorded metric: progressUpdate 
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Successfully updated job progress: 36522e56-cccb-4eed-84a6-ce4a1d927b55 
üé® Starting ENHANCED storybook generation with environmental consistency and professional comic standards...
üìä Configuration: comic-book style, children audience, reused: true
[JobService] Updating job progress: 36522e56-cccb-4eed-84a6-ce4a1d927b55 -> 5% (Analyzing your story structure and creating narrative blueprint...) 
[JobService] Recorded metric: progressUpdate 
[JobService] Successfully updated job progress: 36522e56-cccb-4eed-84a6-ce4a1d927b55 
üìñ PHASE 1: Story Structure Analysis (Story-First Approach)...
[ModularEnterpriseAIService] üìñ Creating CINEMATIC story beats for world-class comic... 
[Gemini] üìù Generating text completion...
[Gemini] üîÑ Calling Gemini API... { operation: 'generateTextCompletion', timeout: '30s', type: 'text' }
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
[Gemini-ERROR] ‚ùå Gemini API call timed out after 30s
[Gemini-ERROR] ‚ùå Attempt 1/1 failed: {
  error: 'Gemini API request timed out',
  errorType: 'AITimeoutError',
  isRetryable: true
}
[Gemini-ERROR] üö´ Circuit breaker opened after 2 failures
[Gemini-ERROR] ‚ùå Text completion failed: AITimeoutError: Gemini API request timed out
    at GeminiIntegration.executeGeminiCall (file:///app/dist/services/ai/modular/gemini-integration.js:721:23)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async GeminiIntegration.generateWithRetry (file:///app/dist/services/ai/modular/gemini-integration.js:633:32)
    at async GeminiIntegration.generateTextCompletion (file:///app/dist/services/ai/modular/gemini-integration.js:171:30)
    at async file:///app/dist/services/ai/ai-service-core.js:939:30
    at async AIService.executeWithErrorHandling (file:///app/dist/services/base/error-aware-base-service.js:177:28)
    at async ErrorCorrelationManager.withContextResult (file:///app/dist/services/errors/error-correlation.js:47:28)
    at async AIService.analyzeStoryStructure (file:///app/dist/services/ai/ai-service-core.js:882:24)
    at async ProductionJobProcessor.processStorybookJobWithServices (file:///app/dist/lib/background-jobs/job-processor.js:464:33)
    at async ProductionJobProcessor.processJobWithServices (file:///app/dist/lib/background-jobs/job-processor.js:413:36) {
  timestamp: '2025-12-04T07:52:31.476Z',
  correlationId: 'err_1764834751476_wvp23o3vg',
  service: 'GeminiIntegration',
  operation: 'generateTextCompletion',
  details: {
    timeout: 30000,
    timeoutSeconds: 30,
    operationType: 'text_generation'
  },
  type: 'AI_TIMEOUT_ERROR',
  category: 'timeout',
  severity: 'medium',
  retryable: true
}
üîó Error Correlation: {
  correlationId: 'corr_1764834721474_nstlfshh0',
  severity: 'medium',
  errorCount: 1,
  affectedServices: [ 'GeminiIntegration' ]
}
‚ö†Ô∏è MEDIUM SEVERITY ERROR: {
  type: 'AI_TIMEOUT_ERROR',
  category: 'timeout',
  severity: 'medium',
  message: 'Gemini API request timed out',
  correlationId: 'err_1764834751476_wvp23o3vg',
  service: 'ModularEnterpriseAIService',
  operation: 'analyzeStoryStructure',
  timestamp: '2025-12-04T07:52:31.476Z'
}
üîó Error Correlation: {
  correlationId: 'corr_1764834721474_nstlfshh0',
  severity: 'medium',
  errorCount: 2,
  affectedServices: [ 'GeminiIntegration' ]
}
‚ùå Story analysis failed: AITimeoutError: Gemini API request timed out
    at GeminiIntegration.executeGeminiCall (file:///app/dist/services/ai/modular/gemini-integration.js:721:23)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async GeminiIntegration.generateWithRetry (file:///app/dist/services/ai/modular/gemini-integration.js:633:32)
    at async GeminiIntegration.generateTextCompletion (file:///app/dist/services/ai/modular/gemini-integration.js:171:30)
    at async file:///app/dist/services/ai/ai-service-core.js:939:30
    timeout: 30000,
    timeoutSeconds: 30,
    at async AIService.executeWithErrorHandling (file:///app/dist/services/base/error-aware-base-service.js:177:28)
    operationType: 'text_generation'
    at async ErrorCorrelationManager.withContextResult (file:///app/dist/services/errors/error-correlation.js:47:28)
  },
    at async AIService.analyzeStoryStructure (file:///app/dist/services/ai/ai-service-core.js:882:24)
  type: 'AI_TIMEOUT_ERROR',
    at async ProductionJobProcessor.processStorybookJobWithServices (file:///app/dist/lib/background-jobs/job-processor.js:464:33)
  category: 'timeout',
    at async ProductionJobProcessor.processJobWithServices (file:///app/dist/lib/background-jobs/job-processor.js:413:36) {
  severity: 'medium',
  timestamp: '2025-12-04T07:52:31.476Z',
  retryable: true
  correlationId: 'err_1764834751476_wvp23o3vg',
}
  service: 'GeminiIntegration',
‚ùå Enhanced job 36522e56-cccb-4eed-84a6-ce4a1d927b55 failed in processEnhancedstorybookJob (UNKNOWN_ERROR): Failed to analyze story structure: Gemini API request timed out
  operation: 'generateTextCompletion',
  details: {
üîó Error Correlation: {
  correlationId: 'corr_1764834720938_y9r89loll',
  severity: 'high',
  errorCount: 1,
  affectedServices: [ 'enhanced-job-processor' ],
  errorChain: [ 'SYSTEM_ERROR' ],
  rootCause: 'SYSTEM_ERROR'
}
[JobService] Job scheduled for retry: 36522e56-cccb-4eed-84a6-ce4a1d927b55 - Failed to analyze story structure: Gemini API request timed out 
[JobService] Recorded metric: failure 
[JobService] Successfully marked job failed: 36522e56-cccb-4eed-84a6-ce4a1d927b55 
üìâ Removed enhanced job 36522e56-cccb-4eed-84a6-ce4a1d927b55 from processing queue (duration: 30797ms, services: job, ai, remaining: 0)
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 1 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 1 jobs 
üìà Added enhanced job 36522e56-cccb-4eed-84a6-ce4a1d927b55 to processing queue (1/5)
üîÑ Processing enhanced job: 36522e56-cccb-4eed-84a6-ce4a1d927b55 (storybook) with professional comic generation capabilities
[JobService] Updating job progress: 36522e56-cccb-4eed-84a6-ce4a1d927b55 -> 1% (Starting enhanced job processing with professional comic generation) 
üìä Worker: Batch processing complete
üìà Total stats: 0 successful, 2 failed
[JobService] Recorded metric: progressUpdate 
[JobService] Successfully updated job progress: 36522e56-cccb-4eed-84a6-ce4a1d927b55 
üé® Starting ENHANCED storybook generation with environmental consistency and professional comic standards...
üìä Configuration: comic-book style, children audience, reused: true
[JobService] Updating job progress: 36522e56-cccb-4eed-84a6-ce4a1d927b55 -> 5% (Analyzing your story structure and creating narrative blueprint...) 
[JobService] Recorded metric: progressUpdate 
[JobService] Successfully updated job progress: 36522e56-cccb-4eed-84a6-ce4a1d927b55 
üìñ PHASE 1: Story Structure Analysis (Story-First Approach)...
[ModularEnterpriseAIService] üìñ Creating CINEMATIC story beats for world-class comic... 
[Gemini] üìù Generating text completion...
[Gemini-ERROR] ‚ùå Attempt 1/1 failed: {
  error: 'Circuit breaker is open for Gemini API',
  errorType: 'AIServiceUnavailableError',
  isRetryable: true
}
[Gemini-ERROR] üö´ Circuit breaker opened after 3 failures
[JobService] Job scheduled for retry: 36522e56-cccb-4eed-84a6-ce4a1d927b55 - Failed to analyze story structure: Circuit breaker is open for Gemini API 
[Gemini-ERROR] ‚ùå Text completion failed: AIServiceUnavailableError: Circuit breaker is open for Gemini API
    at GeminiIntegration.generateWithRetry (file:///app/dist/services/ai/modular/gemini-integration.js:603:31)
    at GeminiIntegration.generateTextCompletion (file:///app/dist/services/ai/modular/gemini-integration.js:171:41)
    at file:///app/dist/services/ai/ai-service-core.js:939:59
    at AIService.executeWithErrorHandling (file:///app/dist/services/base/error-aware-base-service.js:177:34)
    at file:///app/dist/services/base/error-aware-base-service.js:95:29
    at ErrorCorrelationManager.withContextResult (file:///app/dist/services/errors/error-correlation.js:47:34)
      totalRequests: 0,
      errorRate: 0
    }
  },
  type: 'AI_SERVICE_UNAVAILABLE_ERROR',
  category: 'external_service',
  severity: 'high',
  retryable: true
}
    at AIService.withErrorHandling (file:///app/dist/services/base/error-aware-base-service.js:94:44)
üîó Error Correlation: {
    at AIService.analyzeStoryStructure (file:///app/dist/services/ai/ai-service-core.js:882:35)
    at ProductionJobProcessor.processStorybookJobWithServices (file:///app/dist/lib/background-jobs/job-processor.js:464:49)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  timestamp: '2025-12-04T07:53:01.280Z',
  correlationId: 'err_1764834781280_xz460ym49',
  service: 'GeminiIntegration',
  operation: 'generateTextCompletion',
  details: {
    breaker: {
      failures: 3,
      lastFailure: 1764834781281,
      state: 'open',
      threshold: 2,
      timeout: 60000,
      successCount: 0,
  correlationId: 'corr_1764834781280_4mutk0tq5',
  severity: 'high',
  errorCount: 2,
  affectedServices: [ 'GeminiIntegration' ],
  errorChain: [ 'AI_SERVICE_UNAVAILABLE_ERROR', 'AI_SERVICE_UNAVAILABLE_ERROR' ],
  rootCause: 'AI_SERVICE_UNAVAILABLE_ERROR'
}
  correlationId: 'corr_1764834781280_4mutk0tq5',
‚ùå Story analysis failed: AIServiceUnavailableError: Circuit breaker is open for Gemini API
  severity: 'high',
  errorCount: 1,
  affectedServices: [ 'GeminiIntegration' ],
  errorChain: [ 'AI_SERVICE_UNAVAILABLE_ERROR' ],
  rootCause: 'AI_SERVICE_UNAVAILABLE_ERROR'
}
‚ùå HIGH SEVERITY ERROR: {
  type: 'AI_SERVICE_UNAVAILABLE_ERROR',
  category: 'external_service',
  severity: 'high',
  message: 'Circuit breaker is open for Gemini API',
  correlationId: 'err_1764834781280_xz460ym49',
  service: 'ModularEnterpriseAIService',
  operation: 'analyzeStoryStructure',
  timestamp: '2025-12-04T07:53:01.280Z'
}
üîó Error Correlation: {
    at GeminiIntegration.generateWithRetry (file:///app/dist/services/ai/modular/gemini-integration.js:603:31)
    at GeminiIntegration.generateTextCompletion (file:///app/dist/services/ai/modular/gemini-integration.js:171:41)
    at file:///app/dist/services/ai/ai-service-core.js:939:59
    at AIService.executeWithErrorHandling (file:///app/dist/services/base/error-aware-base-service.js:177:34)
    at file:///app/dist/services/base/error-aware-base-service.js:95:29
    at ErrorCorrelationManager.withContextResult (file:///app/dist/services/errors/error-correlation.js:47:34)
    at AIService.withErrorHandling (file:///app/dist/services/base/error-aware-base-service.js:94:44)
    at AIService.analyzeStoryStructure (file:///app/dist/services/ai/ai-service-core.js:882:35)
    at ProductionJobProcessor.processStorybookJobWithServices (file:///app/dist/lib/background-jobs/job-processor.js:464:49)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  timestamp: '2025-12-04T07:53:01.280Z',
  correlationId: 'err_1764834781280_xz460ym49',
  service: 'GeminiIntegration',
  operation: 'generateTextCompletion',
  details: {
    breaker: {
      failures: 3,
      lastFailure: 1764834781281,
      state: 'open',
  errorCount: 1,
      threshold: 2,
  affectedServices: [ 'enhanced-job-processor' ],
  errorChain: [ 'SYSTEM_ERROR' ],
      timeout: 60000,
      successCount: 0,
  rootCause: 'SYSTEM_ERROR'
      totalRequests: 0,
}
      errorRate: 0
[JobService] Recorded metric: failure 
    }
[JobService] Successfully marked job failed: 36522e56-cccb-4eed-84a6-ce4a1d927b55 
  },
üìâ Removed enhanced job 36522e56-cccb-4eed-84a6-ce4a1d927b55 from processing queue (duration: 655ms, services: job, ai, remaining: 0)
  type: 'AI_SERVICE_UNAVAILABLE_ERROR',
  category: 'external_service',
  severity: 'high',
  retryable: true
}
‚ùå Enhanced job 36522e56-cccb-4eed-84a6-ce4a1d927b55 failed in processEnhancedstorybookJob (UNKNOWN_ERROR): Failed to analyze story structure: Circuit breaker is open for Gemini API
üîó Error Correlation: {
  correlationId: 'corr_1764834780874_dn8rguqwt',
  severity: 'high',
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Successfully updated job progress: 36522e56-cccb-4eed-84a6-ce4a1d927b55 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 1 pending jobs from database 
üìñ PHASE 1: Story Structure Analysis (Story-First Approach)...
[ModularEnterpriseAIService] üìñ Creating CINEMATIC story beats for world-class comic... 
[JobService] Recorded metric: jobDiscovery - found 1 jobs 
[Gemini] üìù Generating text completion...
üìà Added enhanced job 36522e56-cccb-4eed-84a6-ce4a1d927b55 to processing queue (1/5)
üîÑ Processing enhanced job: 36522e56-cccb-4eed-84a6-ce4a1d927b55 (storybook) with professional comic generation capabilities
[JobService] Updating job progress: 36522e56-cccb-4eed-84a6-ce4a1d927b55 -> 1% (Starting enhanced job processing with professional comic generation) 
üìä Worker: Batch processing complete
üìà Total stats: 0 successful, 3 failed
    at AIService.withErrorHandling (file:///app/dist/services/base/error-aware-base-service.js:94:44)
[JobService] Recorded metric: progressUpdate 
[JobService] Successfully updated job progress: 36522e56-cccb-4eed-84a6-ce4a1d927b55 
üé® Starting ENHANCED storybook generation with environmental consistency and professional comic standards...
[Gemini-ERROR] ‚ùå Attempt 1/1 failed: {
üìä Configuration: comic-book style, children audience, reused: true
  error: 'Circuit breaker is open for Gemini API',
[JobService] Updating job progress: 36522e56-cccb-4eed-84a6-ce4a1d927b55 -> 5% (Analyzing your story structure and creating narrative blueprint...) 
  errorType: 'AIServiceUnavailableError',
[JobService] Recorded metric: progressUpdate 
  isRetryable: true
}
[Gemini-ERROR] üö´ Circuit breaker opened after 4 failures
[Gemini-ERROR] ‚ùå Text completion failed: AIServiceUnavailableError: Circuit breaker is open for Gemini API
    at GeminiIntegration.generateWithRetry (file:///app/dist/services/ai/modular/gemini-integration.js:603:31)
    at GeminiIntegration.generateTextCompletion (file:///app/dist/services/ai/modular/gemini-integration.js:171:41)
    at file:///app/dist/services/ai/ai-service-core.js:939:59
    at AIService.executeWithErrorHandling (file:///app/dist/services/base/error-aware-base-service.js:177:34)
    at file:///app/dist/services/base/error-aware-base-service.js:95:29
    at ErrorCorrelationManager.withContextResult (file:///app/dist/services/errors/error-correlation.js:47:34)
    at AIService.analyzeStoryStructure (file:///app/dist/services/ai/ai-service-core.js:882:35)
    at ProductionJobProcessor.processStorybookJobWithServices (file:///app/dist/lib/background-jobs/job-processor.js:464:49)
  details: {
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  timestamp: '2025-12-04T07:53:31.254Z',
    breaker: {
  correlationId: 'err_1764834811254_qakxoiahz',
      failures: 4,
  category: 'external_service',
  service: 'GeminiIntegration',
      lastFailure: 1764834811254,
  severity: 'high',
      state: 'open',
  operation: 'generateTextCompletion',
  retryable: true
}
      threshold: 2,
    }
      timeout: 60000,
      successCount: 0,
üîó Error Correlation: {
      totalRequests: 0,
  correlationId: 'corr_1764834811253_udv4mvta9',
      errorRate: 0
  severity: 'high',
  },
  type: 'AI_SERVICE_UNAVAILABLE_ERROR',
  errorCount: 1,
  affectedServices: [ 'GeminiIntegration' ],
  errorChain: [ 'AI_SERVICE_UNAVAILABLE_ERROR' ],
  rootCause: 'AI_SERVICE_UNAVAILABLE_ERROR'
}
‚ùå HIGH SEVERITY ERROR: {
  type: 'AI_SERVICE_UNAVAILABLE_ERROR',
  category: 'external_service',
  severity: 'high',
  message: 'Circuit breaker is open for Gemini API',
  correlationId: 'err_1764834811254_qakxoiahz',
  service: 'ModularEnterpriseAIService',
  operation: 'analyzeStoryStructure',
  timestamp: '2025-12-04T07:53:31.254Z'
}
üîó Error Correlation: {
  correlationId: 'corr_1764834811253_udv4mvta9',
  severity: 'high',
  errorCount: 2,
  affectedServices: [ 'GeminiIntegration' ],
  errorChain: [ 'AI_SERVICE_UNAVAILABLE_ERROR', 'AI_SERVICE_UNAVAILABLE_ERROR' ],
  rootCause: 'AI_SERVICE_UNAVAILABLE_ERROR'
}
‚ùå Story analysis failed: AIServiceUnavailableError: Circuit breaker is open for Gemini API
    at GeminiIntegration.generateWithRetry (file:///app/dist/services/ai/modular/gemini-integration.js:603:31)
    at GeminiIntegration.generateTextCompletion (file:///app/dist/services/ai/modular/gemini-integration.js:171:41)
    at file:///app/dist/services/ai/ai-service-core.js:939:59
    at AIService.executeWithErrorHandling (file:///app/dist/services/base/error-aware-base-service.js:177:34)
    at file:///app/dist/services/base/error-aware-base-service.js:95:29
    at ErrorCorrelationManager.withContextResult (file:///app/dist/services/errors/error-correlation.js:47:34)
    at AIService.withErrorHandling (file:///app/dist/services/base/error-aware-base-service.js:94:44)
    at AIService.analyzeStoryStructure (file:///app/dist/services/ai/ai-service-core.js:882:35)
    at ProductionJobProcessor.processStorybookJobWithServices (file:///app/dist/lib/background-jobs/job-processor.js:464:49)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  timestamp: '2025-12-04T07:53:31.254Z',
  correlationId: 'err_1764834811254_qakxoiahz',
  service: 'GeminiIntegration',
  operation: 'generateTextCompletion',
  details: {
    breaker: {
      failures: 4,
      lastFailure: 1764834811254,
      state: 'open',
      threshold: 2,
      timeout: 60000,
      successCount: 0,
      totalRequests: 0,
      errorRate: 0
    }
  },
  type: 'AI_SERVICE_UNAVAILABLE_ERROR',
  category: 'external_service',
  severity: 'high',
  retryable: true
}
‚ùå Enhanced job 36522e56-cccb-4eed-84a6-ce4a1d927b55 failed in processEnhancedstorybookJob (UNKNOWN_ERROR): Failed to analyze story structure: Circuit breaker is open for Gemini API
üîó Error Correlation: {
  correlationId: 'corr_1764834810883_musx0txe4',
  severity: 'high',
  errorCount: 1,
  affectedServices: [ 'enhanced-job-processor' ],
  errorChain: [ 'SYSTEM_ERROR' ],
  rootCause: 'SYSTEM_ERROR'
}
[JobService] Job scheduled for retry: 36522e56-cccb-4eed-84a6-ce4a1d927b55 - Failed to analyze story structure: Circuit breaker is open for Gemini API 
[JobService] Recorded metric: failure 
[JobService] Successfully marked job failed: 36522e56-cccb-4eed-84a6-ce4a1d927b55 
üìâ Removed enhanced job 36522e56-cccb-4eed-84a6-ce4a1d927b55 from processing queue (duration: 545ms, services: job, ai, remaining: 0)
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
üîÑ Worker: Scanning for pending jobs using consolidated service container...
[JobService] Getting pending jobs with filter: {}, limit: 10 
[JobService] DatabaseService resolved successfully 
[JobService] Calling DatabaseService.getPendingJobs... 
[JobService] Found 0 pending jobs from database 
[JobService] Recorded metric: jobDiscovery - found 0 jobs 
üì≠ Worker: No pending jobs found or concurrency limit reached
